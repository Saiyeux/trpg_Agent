# AI-TRPG 开发计划

## 当前版本状态: v1.0.0 ✅

### 已完成功能
- [x] 基础游戏引擎架构
- [x] 双AI调用系统 (意图分析 + 场景生成)
- [x] 多后端支持 (Ollama + LM Studio)
- [x] 意图识别和统计系统
- [x] 详细日志记录系统
- [x] 配置管理系统
- [x] 优雅退出处理
- [x] 上下文长度显示
- [x] JSON解析问题修复
- [x] 带时间戳的日志文件

## 下一版本计划: v2.0.0

### 🎯 高优先级 (必须完成)

#### 1. RAG功能集成 🔍
**目标**: 添加检索增强生成功能，解决上下文存储和检索问题

**具体任务**:
- [ ] **向量数据库集成**
  - 技术选型: ChromaDB (轻量级) 或 Faiss (高性能)
  - 支持游戏世界知识存储
  - 支持NPC信息、物品描述、地点信息存储

- [ ] **嵌入模型集成**
  - 集成 sentence-transformers 
  - 支持中英文混合嵌入
  - 优化检索精度

- [ ] **语义检索系统**
  - 实现基于玩家行动的智能检索
  - 支持混合检索 (语义 + 关键词)
  - 上下文相关性排序

- [ ] **Function Call检索**
  - 基于检索结果的函数调用
  - 智能选择合适的游戏机制
  - 支持动态函数生成

**预期收益**:
- 解决长期记忆问题
- 提供更丰富的游戏世界背景
- 支持复杂的游戏机制

#### 2. 多模型分工架构 🤖
**目标**: 实现专业化的多模型协作，提高各环节的效果

**分工设计**:

##### 2.1 意图识别专用模型
- [ ] **模型配置**
  - 推荐: qwen2.5:3B (快速响应)
  - 专门优化意图分类accuracy
  - 支持细粒度意图识别

- [ ] **专用Prompt优化**
  - 针对TRPG场景的意图分类
  - 支持复合意图识别
  - 提高分类一致性

##### 2.2 文本生成专用模型
- [ ] **模型配置** 
  - 推荐: Hermes-4-14B (高质量创作)
  - 专门负责场景描述和对话
  - 支持长上下文记忆

- [ ] **创作质量优化**
  - 优化场景描述的生动性
  - 提高角色对话的个性化
  - 加强故事连贯性

##### 2.3 检索与执行专用模型
- [ ] **模型选型**
  - 候选: CodeLlama / DeepSeek-Coder (逻辑推理强)
  - 专门负责函数调用和结果计算
  - 支持复杂的游戏规则执行

- [ ] **执行引擎设计**
  - 基于RAG的智能函数选择
  - 结果验证和错误处理
  - 支持游戏状态的复杂更新

**架构优势**:
- 各模型发挥专长
- 可独立优化和替换
- 支持异构模型协作
- 提高整体系统效果

### 🚀 中优先级 (建议完成)

#### 3. 游戏机制增强
- [ ] **物品系统**
  - 物品数据库设计
  - 背包管理系统
  - 物品使用和交互

- [ ] **NPC系统**
  - NPC人格和记忆系统
  - 动态对话生成
  - 关系系统

- [ ] **技能系统**
  - 玩家属性和技能
  - 技能检定机制
  - 成长系统

- [ ] **地图系统**
  - 位置和移动系统
  - 地图生成和记忆
  - 空间关系管理

#### 4. 用户体验优化
- [ ] **Web界面** (可选)
  - FastAPI后端
  - React前端
  - 实时游戏状态显示

- [ ] **存档系统**
  - 游戏进度保存和加载
  - 多存档支持
  - 存档分享功能

- [ ] **多语言支持**
  - 界面本地化
  - 多语言模型支持
  - 文化适配

### 🔧 低优先级 (长期规划)

#### 5. 高级功能
- [ ] **多人游戏支持**
  - 网络同步
  - 分布式状态管理
  - 实时协作

- [ ] **AI DM助手**
  - 剧情建议系统
  - 难度自动调节
  - 玩家行为分析

- [ ] **插件系统**
  - 自定义游戏规则
  - 第三方模组支持
  - 动态内容加载

## 技术债务和bug修复

### 🐛 当前已知问题
- [x] ~~JSON解析问题 (已修复)~~
- [x] ~~换行符显示问题 (已修复)~~
- [ ] **AI回避具体结果问题** (需要在v2.0解决)
  - 原因: 双AI调用角色混淆
  - 解决: 多模型分工架构 + 改进Prompt设计

### 🔧 技术优化
- [ ] **性能优化**
  - 减少AI调用延迟
  - 缓存机制优化
  - 内存使用优化

- [ ] **代码质量**
  - 添加单元测试
  - 代码覆盖率提升
  - 类型注解完善

- [ ] **文档完善**
  - API文档生成
  - 用户手册编写
  - 开发者指南

## 里程碑计划

### 📅 时间规划

**Phase 1: RAG集成** (预计2-3周)
- Week 1: 向量数据库集成和基础检索
- Week 2: 嵌入模型优化和语义检索
- Week 3: Function Call检索和测试

**Phase 2: 多模型分工** (预计3-4周)  
- Week 1: 意图识别模型专业化
- Week 2: 文本生成模型优化
- Week 3: 执行模型集成
- Week 4: 系统联调和测试

**Phase 3: 游戏机制增强** (预计4-6周)
- Week 1-2: 物品和NPC系统
- Week 3-4: 技能和地图系统  
- Week 5-6: 测试和优化

### 🎯 成功指标

**v2.0版本目标**:
- RAG检索准确率 > 85%
- 多模型协作延迟 < 3秒
- 游戏体验满意度显著提升
- 支持至少50个不同类型的游戏场景

## 资源需求

### 💻 硬件要求
- **开发环境**: 16GB+ RAM, RTX 4070+ GPU
- **生产环境**: 32GB+ RAM, RTX 4090 GPU
- **存储**: 100GB+ SSD (模型和数据)

### 📚 技术栈扩展
- **向量数据库**: ChromaDB / Faiss / Qdrant
- **嵌入模型**: sentence-transformers / BGE
- **Web框架**: FastAPI + React (可选)
- **数据库**: PostgreSQL (持久化)
- **消息队列**: Redis (模型协作)

---

*最后更新: 2025-09-10*  
*维护者: AI-TRPG 开发团队*