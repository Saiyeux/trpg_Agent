# TRPG Agent 测试系统使用指南

## 🎮 可测试的功能清单

基于已完成的Phase 1和Phase 1.5开发，以下功能已实现并可进行测试：

## ✅ **当前可用的测试模块**

### 1. 🎯 **意图识别系统** (完全可测试)
- **状态**: ✅ 完全实现，真实AI集成
- **功能**: 将用户自然语言转换为结构化游戏意图
- **支持的意图类别**:
  - 攻击类：`"我攻击哥布林"`
  - 搜索类：`"搜索房间"`
  - 对话类：`"和商人对话"`
  - 交易类：`"购买治疗药水"`
  - 移动类：`"前往村庄"`
  - 状态查询类：`"查看我的状态"`

**测试内容**:
- ✅ 基本意图分类准确性
- ✅ 目标对象识别
- ✅ 复杂语句理解
- ✅ 置信度评估
- ✅ 响应时间测量
- ✅ 边界情况处理

### 2. ⚙️ **执行引擎** (完全可测试)
- **状态**: ✅ 完全实现，5种GameFunction
- **功能**: 执行游戏逻辑并管理状态变更
- **支持的Function**:
  - `AttackFunction` - 攻击逻辑和伤害计算
  - `SearchFunction` - 搜索和发现物品
  - `DialogueFunction` - NPC对话处理
  - `TradeFunction` - 交易逻辑
  - `StatusFunction` - 状态查询

**测试内容**:
- ✅ 意图到Function的匹配准确性
- ✅ 游戏状态的正确修改
- ✅ 骰子系统和随机性
- ✅ 错误处理和失败情况
- ✅ 状态事务的完整性

### 3. 🎬 **场景生成** (完全可测试)
- **状态**: ✅ 完全实现，双模式场景生成
- **功能**: 将执行结果转换为沉浸式场景描述
- **生成模式**:
  - 动态内容场景 (搜索、对话、交易、状态查询)
  - 标准AI场景生成 (攻击、其他动作)

**测试内容**:
- ✅ 场景描述的质量和准确性
- ✅ 动态内容vs标准内容的区别
- ✅ 数值信息的正确显示
- ✅ 语言风格的一致性
- ✅ 避免模糊表达(禁用"似乎"、"可能"等词)

### 4. ✨ **动态内容生成** (完全可测试)
- **状态**: ✅ 完全实现，AI生成+概念注册
- **功能**: AI动态创建游戏内容并自动管理
- **核心特性**:
  - 搜索时AI生成新物品
  - 对话时AI生成NPC回复
  - 自动注册新概念到概念表
  - 无硬编码内容列表

**测试内容**:
- ✅ 动态物品生成的创造性
- ✅ 概念自动注册功能
- ✅ 生成内容的一致性
- ✅ 硬编码内容检测(应为0%)
- ✅ 概念持久化管理

### 5. 🔗 **完整集成流程** (完全可测试)
- **状态**: ✅ 完全实现，端到端流程
- **功能**: 用户输入→意图识别→执行引擎→场景生成的完整pipeline
- **流程验证**:
  - 三层AI架构协调性
  - 数据流完整性
  - 状态管理一致性
  - 错误传播和处理

**测试内容**:
- ✅ 完整对话流程测试
- ✅ 完整战斗流程测试
- ✅ 完整探索流程测试
- ✅ 多轮交互测试
- ✅ 异常情况恢复测试

## 🚀 **如何开始测试**

### 快速启动
```bash
# 进入项目根目录
cd /path/to/trpg_Agent

# 启动交互式测试系统
python3 testing/runner.py
```

### 预备条件
确保以下服务运行中 (系统会自动检测):
- ✅ **Ollama** (推荐): `http://localhost:11434`
  - 模型: `qwen2.5:3b` 
- ✅ **LM Studio** (备选): `http://localhost:1234`

### 测试流程
1. **选择测试模块** - 从5个可用模块中选择
2. **阅读测试指南** - 系统显示详细的测试说明
3. **执行测试用例** - 按指南输入测试案例
4. **查看实时结果** - 系统显示AI处理结果和性能指标
5. **获得测试报告** - 自动生成结构化的测试分析报告

## 📊 **测试数据收集**

系统会自动记录以下数据:
- **响应时间**: 每个AI调用的耗时
- **准确性**: 意图识别、执行结果的正确性
- **质量评分**: 场景生成的质量指标
- **创造性**: 动态内容的创新程度
- **完整性**: 端到端流程的成功率

### 日志存储位置
```
testing/logs/YYYYMMDD_HHMMSS/
├── session_info.json        # 测试会话信息
├── intent_classification_tests.jsonl  # 意图识别测试日志
├── execution_engine_tests.jsonl       # 执行引擎测试日志
└── test_report.md          # 自动生成的测试报告
```

## 🎯 **重点测试建议**

### 优先测试项目
1. **意图识别准确性** - 这是系统的基础，影响所有后续处理
2. **动态内容生成** - 验证AI创造力和概念管理
3. **完整流程协调** - 确保三层架构协同工作
4. **边界情况处理** - 测试系统的健壮性

### 测试用例建议
```
# 意图识别测试用例
"我攻击哥布林"           # 基本攻击
"和村长聊天了解任务"      # 复杂对话
"仔细搜索这个神秘的宝箱"   # 详细搜索
"购买商人最好的武器"      # 交易请求
"查看我当前的生命值"      # 状态查询

# 边界情况测试
"我想要..."             # 不完整输入
"攻击然后逃跑"          # 多动作语句
"asdfgh"               # 无意义输入
""                     # 空输入
```

## 📈 **性能基准**

### 当前系统性能指标 (参考)
- **意图识别**: < 2秒响应时间，> 90%准确率
- **执行引擎**: < 0.1秒处理时间，> 95%成功率  
- **场景生成**: < 3秒响应时间，> 85%质量评分
- **动态内容**: 100%非硬编码，> 80%创造性评分

### 测试目标
- 验证是否达到或超过基准性能
- 发现性能瓶颈和优化点
- 收集真实使用场景下的数据

## 🔧 **故障排除**

### 常见问题
1. **AI服务不可用**: 检查Ollama或LM Studio是否运行
2. **导入错误**: 确保在项目根目录运行测试
3. **权限问题**: 确保testing/logs/目录可写
4. **测试中断**: 系统支持Ctrl+C安全退出

### 获取帮助
- 查看 `testing/system_design.md` 了解架构详情
- 查看 `testing/analysis_report.md` 了解测试覆盖范围
- 检查 `testing/logs/` 中的错误日志

---

## 🎉 **准备开始测试！**

现在您可以：
1. **启动测试系统**: `python3 testing/runner.py`
2. **选择感兴趣的模块**进行测试
3. **跟随引导文档**完成测试用例
4. **查看生成的测试报告**分析结果
5. **反馈发现的问题**以便进一步改进

整个TRPG Agent系统的核心功能都已实现并可测试，期待您的测试反馈！🚀